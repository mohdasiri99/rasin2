import pandas as pd
from datetime import datetime

class RasinMatrixEngine:
    def __init__(self):
        # ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£ÙˆØ²Ø§Ù† Ø§Ù„Ù†Ø³Ø¨ÙŠØ© ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ 
        self.weights = {
            'R': {'name': 'Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙ…ÙŠÙ…', 'weight': 28},
            'A': {'name': 'Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚', 'weight': 24},
            'S': {'name': 'Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„ØªÙ…ÙƒÙŠÙ†', 'weight': 18},
            'I': {'name': 'Ø§Ù„Ø´Ù…ÙˆÙ„ ÙˆØ§Ù„ÙˆØµÙˆÙ„', 'weight': 16},
            'N': {'name': 'Ø§Ù„Ø£Ø«Ø± ÙˆØ§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©', 'weight': 14}
        }
        
        # ØªØ¹Ø±ÙŠÙ Ù†Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªØµÙ†ÙŠÙ ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¹ØªÙ…Ø¯ 
        self.categories = {
            'Gold': {'min': 90, 'label': 'Ø±ØµÙŠÙ† Ø°Ù‡Ø¨ÙŠ ğŸ¥‡ (ØªÙ…ÙŠØ² Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠ)'},
            'Silver': {'min': 80, 'label': 'Ø±ØµÙŠÙ† ÙØ¶ÙŠ ğŸ¥ˆ (Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©)'},
            'Bronze': {'min': 70, 'label': 'Ø±ØµÙŠÙ† Ø¨Ø±ÙˆÙ†Ø²ÙŠ ğŸ¥‰ (ÙŠÙÙŠ Ø¨Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª)'},
            'Fail': {'min': 0, 'label': 'ÙŠØ­ØªØ§Ø¬ ØªØ·ÙˆÙŠØ± ğŸ› ï¸ (ÙŠØªØ·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ù‡ÙŠÙƒÙ„Ø©)'}
        }

    def evaluate_project(self, project_name, gate_checks, scores):
        """
        Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        :param project_name: Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
        :param gate_checks: Ù‚Ø§Ù…ÙˆØ³ Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„Ø¹Ø¨ÙˆØ± (Ù†Ø¹Ù…/Ù„Ø§)
        :param scores: Ù‚Ø§Ù…ÙˆØ³ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø®Ø§Ù… Ù„ÙƒÙ„ Ù…Ø¹ÙŠØ§Ø± (Ù…Ù† 100)
        """
        
        # 1. Ù…Ø±Ø­Ù„Ø© Ø§Ù„ÙÙ„ØªØ±Ø© (Gatekeeping)
        # Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ÙÙŠ Ø£ÙŠ Ù…Ù† Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø£Ù‡Ù„ÙŠØ©ØŒ ÙŠØªÙ… Ø±ÙØ¶Ù‡ ÙÙˆØ±Ø§Ù‹
        for check, passed in gate_checks.items():
            if not passed:
                return {
                    'Project': project_name,
                    'Status': 'Rejected â›”',
                    'Reason': f'ÙØ´Ù„ ÙÙŠ Ù…Ø¹ÙŠØ§Ø± Ø§Ù„Ø£Ù‡Ù„ÙŠØ©: {check}',
                    'Final_Score': 0
                }

        # 2. Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù…ÙˆØ²ÙˆÙ† (Weighted Scoring)
        final_score = 0
        details = {}
        
        print(f"\n--- ØªØ­Ù„ÙŠÙ„ Ø£Ø¯Ø§Ø¡ Ù…Ø´Ø±ÙˆØ¹: {project_name} ---")
        
        for code, criteria in self.weights.items():
            # Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø®Ø§Ù… (Ù…Ù† 100) Ø§Ù„ØªÙŠ ÙˆØ¶Ø¹Ù‡Ø§ Ø§Ù„Ù…Ø­ÙƒÙ…
            raw_score = scores.get(code, 0) 
            # Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ø³Ø¨ÙŠ Ù„Ù„Ù…Ø¹ÙŠØ§Ø±
            weight = criteria['weight']
            # Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù…ÙˆØ²ÙˆÙ†Ø© (Ø§Ù„ØªÙŠ ØªØ¯Ø®Ù„ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)
            weighted_score = (raw_score / 100) * weight
            
            final_score += weighted_score
            details[code] = weighted_score
            
            print(f"Ø§Ù„Ù…Ø¹ÙŠØ§Ø± {code} ({criteria['name']}): Ø­ØµÙ„ Ø¹Ù„Ù‰ {raw_score}/100 -> ÙŠØ³Ø§Ù‡Ù… Ø¨Ù€ {weighted_score:.2f} Ù†Ù‚Ø·Ø©")

        # 3. Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØµÙ†ÙŠÙ (Classification)
        category_label = self.get_category(final_score)
        
        return {
            'Project': project_name,
            'Status': 'Evaluated âœ…',
            'Final_Score': round(final_score, 2),
            'Category': category_label,
            'Details': details
        }

    def get_category(self, score):
        if score >= self.categories['Gold']['min']:
            return self.categories['Gold']['label']
        elif score >= self.categories['Silver']['min']:
            return self.categories['Silver']['label']
        elif score >= self.categories['Bronze']['min']:
            return self.categories['Bronze']['label']
        else:
            return self.categories['Fail']['label']

# --- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø­Ø§ÙƒØ§Ø© (ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù…Ù„ÙŠ) ---

# 1. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ø­Ø±Ùƒ
engine = RasinMatrixEngine()

# 2. Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´Ø±ÙˆØ¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ù„Ù„ØªØ¬Ø±Ø¨Ø©)
project_data = {
    'name': 'Ù†Ø§Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡ Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ†',
    'gates': {
        'Safety': True,       # Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„ÙÙƒØ±ÙŠØ©
        'Legal': True,        # Ø§Ù„ØµÙØ© Ø§Ù„Ù†Ø¸Ø§Ù…ÙŠØ©
        'Language': True      # Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù„ØºÙˆÙŠØ©
    },
    'scores': {
        'R': 95,  # Ù‚ÙˆÙŠ Ø¬Ø¯Ø§Ù‹ ÙÙŠ Ø§Ù„ØªØµÙ…ÙŠÙ… (Ù…Ù† 100)
        'A': 85,  # Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ ÙÙŠ Ø§Ù„Ø£Ù†Ø´Ø·Ø©
        'S': 70,  # Ù…ØªÙˆØ³Ø· ÙÙŠ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        'I': 60,  # Ø¶Ø¹ÙŠÙ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø´Ø§Ù…Ù„
        'N': 50   # Ø¶Ø¹ÙŠÙ ÙÙŠ Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø±
    }
}

# 3. ØªÙ†ÙÙŠØ° Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
result = engine.evaluate_project(
    project_data['name'], 
    project_data['gates'], 
    project_data['scores']
)

# 4. Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Simulating the Dashboard Output)
print("\n" + "="*40)
print("ğŸ“„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ - Ù†Ø¸Ø§Ù… Ø±ØµÙŠÙ†")
print("="*40)
print(f"Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: {result['Project']}")
print(f"Ø§Ù„Ø­Ø§Ù„Ø©: {result['Status']}")

if result['Status'] == 'Evaluated âœ…':
    print(f"Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…ÙˆØ²ÙˆÙ†Ø©: {result['Final_Score']} / 100")
    print(f"Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø³ØªØ­Ù‚: {result['Category']}")
    print("-" * 20)
    print("ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·:")
    print(f" - R (Ø§Ù„Ø¨Ø­Ø«): {result['Details']['R']} / 28")
    print(f" - A (Ø§Ù„Ø£Ù†Ø´Ø·Ø©): {result['Details']['A']} / 24")
    print(f" - S (Ø§Ù„Ø­ÙˆÙƒÙ…Ø©): {result['Details']['S']} / 18")
    print(f" - I (Ø§Ù„Ø´Ù…ÙˆÙ„): {result['Details']['I']} / 16")
    print(f" - N (Ø§Ù„Ø£Ø«Ø±): {result['Details']['N']} / 14")
else:
    print(f"Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶: {result['Reason']}")
print("="*40)

# Ù…ÙŠØ²Ø© Ø¥Ø¶Ø§ÙÙŠØ©: ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Excel (Ù…Ø­Ø§ÙƒØ§Ø©)
# df = pd.DataFrame([result])
# df.to_excel("Rasin_Report.xlsx")
# print("ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Excel")
